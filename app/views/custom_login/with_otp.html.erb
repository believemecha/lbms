
<div class="container my-4">
        <div class="row w-100">
            <%= image_tag(url_for("logo.png"), style: "width:100%;height:200px") %>
        </div>
        <div id="formConatiner">
            <div class="row w-100">
                <div class="col-md-3"></div>
                <div class="card col-md-6">
                    <div class="card-body">
                        <h2 class="card-title mb-4 text-center">Login</h2>
                            <div class="form-group">
                                <p id="error_text"></p>
                                <input type="email" class="form-control" id="email" placeholder="Enter your username or email">
                            </div>
                            <button type="submit" class="btn btn-primary btn-block mt-3" id="generate_otp" onclick="generateOtp()">Generate OTP</button>
                    </div>
                </div>
                <div class="col-md-3"></div>
            </div>
        </div>
        <div class="row w-100" id="otp_verfiy_container" style="display:none;">
            <div class="col-md-3"></div>
            <div class="card col-md-6">
                <div class="card-body">
                    <h2 class="card-title mb-4 text-center">Login</h2>
                        <div class="form-group">
                            <p class="text-success">Otp sent</p>
                            <p id="otp_error_text" class="text-danger"></p>
                            <input type="number" class="form-control" id="email_otp" name="email_otp" placeholder="Enter Otp Sent to Your Email">
                        </div>
                        <button type="submit" class="btn btn-primary btn-block mt-3" id="verfify_otp" onclick="verfiyOtp()">Verfify</button>
                </div>
            </div>
            <div class="col-md-3"></div>
        </div>       

        
</div>

<script>
    function generateOtp() {
        var email = document.getElementById("email").value;
        const btngene = document.getElementById("generate_otp");
        btngene.innerHTML = "Generating";
        btngene.disabled = true;
        $.ajax({
        type: 'POST',
        url: '/custom_login/generate_otp',
        data: {email: email},
        headers:{"X-CSRF-Token": document.querySelector('meta[name="csrf-token"]').content},
        success: function (data) {
            if(data.status){
                document.getElementById("formConatiner").style.display ="none";
                document.getElementById("otp_verfiy_container").style.display ="";
            }
            else{
                document.getElementById("error_text").innerHTML = data?.message;
            }
        }
        });
        btngene.innerHTML = "Generate OTP";
        btngene.disabled = false;
    }

    function verfiyOtp() {
        var otp = document.getElementById("email_otp").value;
            $.ajax({
            type: 'POST',
            url: '/custom_login/verify_otp',
            data: {email: document.getElementById("email").value, otp: otp},
            headers:{"X-CSRF-Token": document.querySelector('meta[name="csrf-token"]').content},
            success: function (data) {
                console.log(data,"data");
                if(data.status){
                    window.location.href="/"
                }
                else{
                    document.getElementById("otp_error_text").innerHTML = data?.message;
                }
            }
    });
    }
</script>
